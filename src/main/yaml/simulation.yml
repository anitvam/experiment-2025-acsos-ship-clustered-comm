environment:
  type: NavigationEnvironment
  parameters:
    - ["maps/north_germany_coastline.geojson"]
 #   - ["maps/north_germany_waterways.geojson", "maps/north_germany_waterways3.geojson"]

variables:
  one-minute-hz: &one-minute-hz
    formula: 1 / 60
  update-frequency: &update-frequency
    type: ArbitraryVariable
    parameters: [0.5, [*one-minute-hz, 0.1, 0.5, 1.0]]
  5g-probability: &5g-probability
    type: ArbitraryVariable
    parameters: [0.01, [0, 0.01, 0.02, 0.05, 0.1, 0.2, 0.5, 1]]
#  5g-probability: &5g-probability
#    default: 0.01
#    min: 0.0
#    max: 1.0
#    step: 0.1
  payload-size: &payload-size # in Mbps
    type: ArbitraryVariable
    parameters: [3, [0.001, 0.064, 0.1, 0.320, 3, 5]]
  seed: &seed
    min: 0
    max: 3
    step: 1
    default: 0
incarnation: collektive

network-model:
  type: ConnectWithinDistance
  parameters: [15000]

_pool: &program
  - time-distribution: 0.5
    program:
      name: "ShipComm"
      code: |
        import it.unibo.clustered.seaborn.comm.*
      entrypoint: |
        entrypoint(device)

_pools:
  - pool: &move
      - time-distribution: 0.1
        type: Event
        actions:
          - type: ReproduceGPSTrace
            parameters:
              path: "navigation-routes"
              cycle: false
              normalizer: "AlignToSimulationTime"
              normalizerArgs: []
      - time-distribution:
          type: Trigger
          parameters: [ 0 ]
        type: Event
        actions:
          - type: LoadIdFromTrace
            parameters: [ "navigation-routes" ]
deployments:
  - type: FromGPSTraceCustom
    parameters:
      path: "navigation-routes" # Folder containing GPS traces
      normalizer: "AlignToSimulationTime"
      normalizerArgs: []
    programs:
      - *move
      - *program
    contents:
      - molecule: 5gProbability
        concentration: *5g-probability
      - molecule: payloadSize
        concentration: *payload-size
  - type: SpecificPositions
    parameters:
      - [ 54.26, 9.63 ] # Rendsburg, Germany
      - [ 54.36, 10.07 ] # Kiel-Suchsdorf, Germany
      - [ 54.33, 10.08 ] # Kiel-2, Germany
      - [ 54.37, 10.12 ] # Kiel, Germany
      - [ 54.39, 10.18 ] # Friedrichsort, Germany
      - [ 54.81, 11.14 ] # Island Brigge, Denmark
    programs:
      - *program
    contents:
      - molecule: station
        concentration: true
      - molecule: payloadSize
        concentration: *payload-size
  - type: SpecificPositions # Vodafone.de 5G antenna approx position taken from opensource data (cellmapper.net)
    parameters:
      - [54.465360, 10.085189] #3411
      - [54.449901, 10.006147] #5414
      - [54.433701, 9.907289] #4595
      - [54.451517, 9.839018] #1200
      - [54.423243, 10.036692] #1376
      - [54.393440, 10.171203] #5804
      - [54.371412, 10.139636] #2211793
      - [54.360053, 10.129973] #1254
      - [54.354620, 10.116552] #1442
      - [54.342499, 10.092394] #8594
      - [54.335915, 10.118521] #2211115
      - [54.333658, 10.144607] #2213317
      - [54.320849, 10.107905] #2212398
      - [54.315291, 10.127834] #2055
      - [54.311135, 10.127193] #11655
      - [54.305976, 10.117297] #5790
      - [54.316873, 10.144532] #5612
      - [54.317879, 10.154619] #2210967
      - [54.322164, 10.166006] #2209985
      - [54.368318, 10.224928] #2209534
      - [54.473953, 9.835990] #2212896
      - [54.494095, 9.860919] #1226
      - [54.582523, 10.016081] #2210141
    programs:
      - *program
    contents:
      - molecule: 5gAntenna
        concentration: true
      - molecule: payloadSize
        concentration: *payload-size

terminate:
  type: AfterTime
  parameters: 86400

launcher:
  parameters:
    batch: [seed, 5g-probability]
    showProgress: true
    autoStart: true

seeds:
  scenario: *seed
  simulation: *seed

export:
  - type: CSVExporter
    parameters:
      fileNameRoot: clustered_comm
      interval: 1.0
      exportPath: data
    data:
      - time
      - molecule: data-rate-towards-leader # INTRA-CLUSTER
        aggregators: [ mean, variance, median ]
        value-filter: "onlyFinite"
      - molecule: inter-cluster-data-rate # INTER-CLUSTER
        aggregators: [ mean, variance, median ]
        value-filter: "onlyFinite"
      - molecule: distanceToLeader
        aggregators: [ mean, variance, median ]
        value-filter: "onlyFinite"

      # cluster size: Conto quante occorrenze del myL eader ho
      # clusters count: Esporto il leader e faccio un estrattore che conta le singole occorrenze dei leader.
      # clusters of one element. Conto quante occorrenze del myLeader ho e tengo quelle di dimensione 1.
      # Reduction factor := sum(intra-cluster-data-rate)/sum(inter-cluster-data-rate)
      # Single-element data-rate (==data-rate) => Metrica con cui ci compariamo con le baseline
      # Loss factor (amount of information received by the leader / amount of info. trasmitted)
